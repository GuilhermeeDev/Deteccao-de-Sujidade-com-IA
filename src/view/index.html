<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload & Resultados</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      display: flex; height: 100vh;
      font-family: Arial, sans-serif; background: #f5f5f5;
    }
    .panel {
      width: 50%; padding: 30px; overflow-y: auto;
    }
    .left {
      background: #fff; border-right: 1px solid #ddd;
    }
    .right {
      background: #fafafa;
    }
    h2 {
      text-align: center; margin-bottom: 20px;
      color: #333;
    }
    form {
      display: flex; flex-direction: column; align-items: center;
    }
    input[type="file"] {
      width: 80%; padding: 15px;
      border: 2px dashed #aaa; border-radius: 8px;
      background: #fff; cursor: pointer;
      transition: border-color 0.3s;
    }
    input[type="file"]:hover { border-color: #4caf50; }
    button {
      margin-top: 20px; padding: 10px 25px;
      background: #4caf50; color: #fff; border: none;
      border-radius: 5px; cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #45a049; }
    pre#response {
      margin-top: 25px; width: 90%;
      background: #f0f0f0; padding: 15px;
      border: 1px solid #ccc; border-radius: 6px;
      font-size: 14px; color: #333;
      overflow-x: auto;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
    }
    th, td {
      padding: 10px; border: 1px solid #ccc; text-align: left;
    }
    th {
      background: #4caf50; color: #fff;
    }
    tr:nth-child(even) { background: #f2f2f2; }
    @media (max-width: 768px) {
      body { flex-direction: column; }
      .panel { width: 100%; height: 50vh; }
    }
  </style>
</head>

<body>
  <div class="panel left">
    <h2>Envio de Imagens</h2>
    <form id="mediaForm">
      <input
        type="file"
        id="fileInput"
        name="files"
        accept="image/*"
        multiple
      >
      <button type="submit">Enviar para Inferência</button>
    </form>
    <pre id="response"></pre>
  </div>

  <div class="panel right">
    <h2>Resultados Salvos</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Característica</th>
          <th>Data</th>
          <th>Hora</th>
        </tr>
      </thead>
      <tbody id="tabela-resultados">
        <!-- Preenchido pelo JS -->
      </tbody>
    </table>
  </div>

   <script>
    const endpoint = "http://127.0.0.1:8000/enviar_imagem/";
    const form = document.getElementById('mediaForm');
    const input = document.getElementById('fileInput');
    const responseDiv = document.getElementById('response');

    form.addEventListener('submit', async (e) => {
      
      e.preventDefault();
      responseDiv.textContent = '';
      if (!input.files.length) {
        responseDiv.textContent = 'Selecione ao menos um arquivo.';
        return;
      }
      alert("Imagem enviada!")
      const formData = new FormData();
      Array.from(input.files).forEach(file => formData.append('files', file));
      try {
        const res = await fetch(endpoint, { method: 'POST', body: formData });
        const data = await res.json();
        responseDiv.textContent = res.ok ? JSON.stringify(data, null, 2) : `Erro ${res.status}: ${data.message || res.statusText}`;
        if (res.ok) carregarResultados();
      } catch (err) {
        responseDiv.textContent = 'Erro: ' + err.message;
      }
    });

    async function carregarResultados() {
      try {
        const res = await fetch('http://127.0.0.1:8001/resultados/');
        const dados = await res.json();
        if (!Array.isArray(dados)) {
          console.error('Resposta de resultados inválida:', dados);
          return;
        }
        const tabela = document.getElementById('tabela-resultados');
        tabela.innerHTML = '';
        dados.forEach(item => {
          const row = `
            <tr>
              <td>${item.id}</td>
              <td>${item.caracteristica}</td>
              <td>${item.data_processamento}</td>
              <td>${item.hora_processamento}</td>
            </tr>`;
          tabela.insertAdjacentHTML('beforeend', row);
        });
      } catch (err) {
        console.error('Erro ao carregar resultados:', err);
      }
    }

    window.onload = carregarResultados;
  </script>

</body>
</html>
